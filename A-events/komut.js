//-------------------------------------------------------------------------------------------------------//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------//-------------------------------------------------------------------------------------------------------

const Discord = require('discord.js');
const moment = require('moment');
const chalk = require('chalk');
const db = require('discowdb');
const ayarlar = require('../A-ayarlar');

moment.locale("tr")

//-------------------------------------------------------------------------------------------------------//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------//-------------------------------------------------------------------------------------------------------

  module.exports = async client => {

//-------------------------------------------------------------------------------------------------------//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------//-------------------------------------------------------------------------------------------------------

//-------------------------------------------------------------------------------------------------------//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------//-------------------------------------------------------------------------------------------------------

client.on("message", async message => {

    if(message.author.bot) {
    if(message.author.id != client.user.id) return;
}

const msunucu = message.guild
const muye = message.member
const msahip = message.author
const mkanal = message.channel

const prefix = ayarlar.bot.prefix || "discow!"

    if (!message.content.startsWith(prefix)) return;
let command = message.content.split(' ')[0].slice(prefix.length);
let params = message.content.split(' ').slice(1);
let cmd;

    if (!client.commands.has(command)) {
    if (client.aliases.has(command)) {
  cmd = client.commands.get(client.aliases.get(command));
} else {
    if(command == '') return;
}
}

    if (client.commands.has(command)) {
  cmd = client.commands.get(command);
} else if (client.aliases.has(command)) {
  cmd = client.commands.get(client.aliases.get(command));
}

//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------
//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------
//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------

    if (cmd) {

//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------
//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------
//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------

const discow = new Discord.MessageEmbed().setColor('BLACK').setFooter(`${ayarlar.status.status_footer}`, message.author.avatarURL({ dynamic: true, size: 2048 })).setTimestamp()
const dikkat = client.emojis.cache.find(x => x.name === ayarlar.emojiler.discow_carpi)
const tik = client.emojis.cache.find(x => x.name === ayarlar.emojiler.discow_tik)
const ok = client.emojis.cache.find(x => x.name === ayarlar.emojiler.discow_ok)

const komutlog = client.channels.cache.get(ayarlar.bot.komutlog)

const tarih = moment(new Date()).format("LLLL:ss")

//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------
//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------
//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------

function gonderm(mesaj) {
  mkanal.send(discow.setDescription(mesaj)).then(x => x.delete({ timeout: 15000 })).catch(err => { })
}

function dikkatm(mesaj) {
  mkanal.send(discow.setDescription(`${dikkat} ${mesaj} ${dikkat}`)).then(x => x.delete({ timeout: 15000 })).catch(err => { })
}
      
function embedm(mesaj) {
  mkanal.send(mesaj, { code: "js", split: true })
}
      
function logconsole(arg) {
  console.log(chalk.yellow(tarih)+" / "+chalk.magenta("DiscowZombie | Bot")+" / "+chalk.bold.green(arg))
}

//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------
//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------
//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------
      
  cmd.run(client, message, params).catch(err => gonderm(`${dikkat} **Komutta Bir Hata Oluştu.** ${dikkat}

${ok} **Hata :**
**\`\`\`fix\n${err}\`\`\`**`))

if(message.channel.type != "dm") {
  
  komutlog.send(discow.setDescription(`${ok} **Komutu Kullanan : ${msahip}
\`\`\`fix\n${msahip.tag} / ${msahip.id}\`\`\`**
${ok} **Komutun Kullanıldığı Kanal : ${mkanal}
\`\`\`fix\n#${mkanal.name} / ${mkanal.id}\`\`\`**
${ok} **Komutun Kullanıldığı Sunucu : (\`${msunucu}\`)
\`\`\`fix\n${msunucu.name} / ${msunucu.id} / ${msunucu.memberCount}\`\`\`**
${ok} **Kullanılan Komut : (\`${command}\`)
\`\`\`fix\n${prefix+command}\`\`\`**
${ok} **Mesaj :
${200 >= message.content.length ? `\`\`\`fix\n${message.content}\`\`\`` : `\`\`\`fix\nMesaj Çok Uzun Olduğu İçin Gösterilmiyor.\`\`\``}**
${ok} **Tarih : \`${tarih}\`**`))
      
  logconsole(`Bir Komut Kullandıldı. / Komut : ${prefix+command} / Komutu Kullanan : ${msahip.tag} | ${msahip.id} / Komutun Kullandıldığı Kanal : #${mkanal.name} | ${mkanal.id} / Mesaj : ${200 >= message.content.length ? message.content : "Mesaj Çok Uzun Olduğu İçin Gösterilmiyor."}`)    
  
} else {

if(db.get("Karaliste_DM&"+message.author.id)) return;
message.channel.send("Kardeş Komutu Siktir Git Sunucuda Dene!")
db.set("Karaliste_DM&"+message.author.id)
  
}
      
}})};

//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------
//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------
//--------------------------------------------------//--------------------------------------------------//--------------------------------------------------
